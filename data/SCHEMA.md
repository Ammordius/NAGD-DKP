# DKP structured data schema

Generated by `extract_structured_data.py` from scraped GamerLaunch data. Use these tables as the source for your DKP website.

## Tables (CSV + SQLite)

| File | Description |
|------|-------------|
| **characters** | Guild roster: one row per character. `char_id` = site character ID; `class_name` = class (Bard, Cleric, etc.). |
| **accounts** | Linked accounts (same player, multiple toons). `account_id`, `char_ids` (comma-sep), `toon_names`, `toon_count`. |
| **character_account** | Mapping character → account. `char_id`, `account_id`. |
| **raids** | All past raids. `raid_id`, `raid_name`, `date`, `date_iso` (YYYY-MM-DD), `attendees` (count), `url`. |
| **raid_events** | DKP events within each raid (e.g. "On-Time attendance", "1 Hour Single/Double Boxing"). `raid_id`, `event_id`, `event_order`, `event_name`, `dkp_value`, `attendee_count`, `event_time`. |
| **raid_loot** | Item drops and who won them. `raid_id`, `event_id`, `item_name`, `char_id`, `character_name`, `cost` (DKP spent). Some rows may have empty `item_name` (alternate page layout). |
| **raid_attendance** | Who attended each raid (raid-level list). `raid_id`, `char_id`, `character_name`. `(*)` in name = historical / left guild. |

## Relationships

- **characters** ↔ **character_account** ↔ **accounts**: characters belong to one account (linked toons).
- **raids** → **raid_events**: each raid has one or more events (each event has a DKP value).
- **raid_events** → **raid_loot**: loot rows reference the event they were awarded in.
- **raids** → **raid_attendance**: many-to-many (raid × character) for “who was on the raid”.
- **raid_loot** references **char_id** / **character_name** (same as **characters** when in roster).

## SQLite

`dkp.db` contains the same tables. Example:

```sql
-- Total DKP earned per character (from attendance at events)
SELECT c.name, SUM(CAST(re.dkp_value AS REAL)) AS total_earned
FROM raid_attendance ra
JOIN characters c ON c.char_id = ra.char_id
JOIN raid_events re ON re.raid_id = ra.raid_id
GROUP BY c.char_id;

-- Loot spent per character
SELECT character_name, SUM(CAST(cost AS INT)) AS total_spent
FROM raid_loot
WHERE cost != ''
GROUP BY char_id;
```

## Re-run extraction

From project root:

```bash
python extract_structured_data.py
```

Options: `--data-dir data`, `--sqlite data/dkp.db`, `--limit-raids N` (test on N raids).
